name: Build

on:
  push:
    branches: [ master ]
  pull_request:
    branches: [ master ]

jobs:
  build:

    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4
    - name: Set up JDK 1.8
      uses: actions/setup-java@v4
      with:
        java-version: '8'
        distribution: 'temurin'
    - name: Build Omicron Player
      run: |
        cd omicron-player
        mvn --batch-mode clean compile install package
    - name: Deploy Player
      uses: actions/upload-artifact@v4
      with:
        name: 'omicron.jar'
        path: omicron-player/omicron-assembly/target/omicron.jar       
    - name: Build Hello World cart
      run: |
        cd demo/HelloWorld
        mvn --batch-mode clean compile install package
    - name: Build FeatureDemo cart
      run: |
        cd demo/FeatureDemo
        mvn --batch-mode clean compile install package
    - name: Build FeatureDemoStandalone
      run: |
        cd demo/FeatureDemoStandalone
        mvn --batch-mode clean compile install package
    - name: Build AlienBuster cart
      run: |
        cd demo/AlienBuster
        mvn --batch-mode clean compile install package
    - name: Build Retrodrawing cart
      run: |
        cd demo/Retrodrawing
        mvn --batch-mode clean compile install package
    - name: Build Snake cart
      run: |
        cd demo/Snake
        mvn --batch-mode clean compile install package
    - name: Deploy AlienBuster Demo
      uses: actions/upload-artifact@v4
      with:
        name: 'alienbuster.omicron'
        path: demo/AlienBuster/alienbuster.omicron
    - name: Deploy HelloWorld Demo
      uses: actions/upload-artifact@v4
      with:
        name: 'helloworld.omicron'
        path: demo/HelloWorld/helloworld.omicron
    - name: Deploy FeatureDemo Demo
      uses: actions/upload-artifact@v4
      with:
        name: 'feature-demo.omicron'
        path: demo/FeatureDemo/feature-demo.omicron
    - name: Deploy Snake Demo
      uses: actions/upload-artifact@v4
      with:
        name: 'snake.omicron'
        path: demo/Snake/snake.omicron
    - name: Deploy Retrodrawing Demo
      uses: actions/upload-artifact@v4
      with:
        name: 'retrodrawing.omicron'
        path: demo/Retrodrawing/retrodrawing.omicron
        
    - name: Setup Android SDK
      uses: android-actions/setup-android@v3
      with:
        cmdline-tools-version: 8512546
    - name: Install packages        
      run: |
        sdkmanager "build-tools;33.0.2" "platforms;android-26"        
    - name: Build AlienBuster Android app
      run: |
        cd android-mvn
        mvn --batch-mode -Dcartridge.artifactId=alienbuster -Dcartridge.groupId=com.github.msx80.omicron -Dcartridge.version=0.0.3 clean install android:apk
    - name: Deploy AlienBuster Android App
      uses: actions/upload-artifact@v4
      with:
        name: 'alienbuster.apk'
        path: android-mvn/target/alienbuster.apk
    - name: Build Featuredemo Android app
      run: |
        cd android-mvn
        mvn --batch-mode -Dcartridge.artifactId=feature-demo -Dcartridge.groupId=com.github.msx80.omicron -Dcartridge.version=0.0.3 clean install android:apk
    - name: Deploy feature-demo Android App
      uses: actions/upload-artifact@v4
      with:
        name: 'feature-demo.apk'
        path: android-mvn/target/feature-demo.apk
    - name: Build retrodrawing Android app
      run: |
        cd android-mvn
        mvn --batch-mode -Dcartridge.artifactId=retrodrawing -Dcartridge.groupId=com.github.msx80.omicron -Dcartridge.version=0.0.3 clean install android:apk
    - name: Deploy retrodrawing Android App
      uses: actions/upload-artifact@v4
      with:
        name: 'retrodrawing.apk'
        path: android-mvn/target/retrodrawing.apk
    - name: Build snake Android app
      run: |
        cd android-mvn
        mvn --batch-mode -Dcartridge.artifactId=snake -Dcartridge.groupId=com.github.msx80.omicron -Dcartridge.version=0.0.3 clean install android:apk
    - name: Deploy snake Android App
      uses: actions/upload-artifact@v4
      with:
        name: 'snake.apk'
        path: android-mvn/target/snake.apk
    - name: Build helloworld Android app
      run: |
        cd android-mvn
        mvn --batch-mode -Dcartridge.artifactId=helloworld -Dcartridge.groupId=com.github.msx80.omicron -Dcartridge.version=0.0.3 clean install android:apk
    - name: Deploy helloworld Android App
      uses: actions/upload-artifact@v4
      with:
        name: 'helloworld.apk'
        path: android-mvn/target/helloworld.apk        
